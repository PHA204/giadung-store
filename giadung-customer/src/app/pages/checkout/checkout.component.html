<div class="checkout-container">
  <!-- Success Message -->
  <div *ngIf="orderSuccess" class="success-message">
    <div class="success-icon">‚úÖ</div>
    <h2>ƒê·∫∑t h√†ng th√†nh c√¥ng!</h2>
    <p>C·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t h√†ng. Ch√∫ng t√¥i s·∫Ω li√™n h·ªá v·ªõi b·∫°n s·ªõm nh·∫•t.</p>
    <div class="loading-spinner">ƒêang chuy·ªÉn h∆∞·ªõng...</div>
  </div>

  <!-- Checkout Form -->
  <div *ngIf="!orderSuccess" class="checkout-content">
    <!-- Header -->
    <div class="checkout-header">
      <button class="btn-back" (click)="goToCart()">
        ‚Üê Quay l·∫°i gi·ªè h√†ng
      </button>
      <h1>Thanh to√°n</h1>
      <p class="step-indicator">
        <span class="step active">1. Gi·ªè h√†ng</span>
        <span class="step-divider">‚Üí</span>
        <span class="step active">2. Thanh to√°n</span>
        <span class="step-divider">‚Üí</span>
        <span class="step">3. Ho√†n t·∫•t</span>
      </p>
    </div>

    <!-- Error Message -->
    <div *ngIf="orderError" class="error-banner">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span>{{ orderError }}</span>
      <button class="btn-close" (click)="orderError = null">√ó</button>
    </div>

    <div class="checkout-grid">
      <!-- Left Column - Forms -->
      <div class="checkout-forms">
        <form [formGroup]="checkoutForm" (ngSubmit)="submitOrder()">
          <!-- Customer Information -->
          <div class="form-section">
            <h2>Th√¥ng tin kh√°ch h√†ng</h2>
            
            <div class="form-group">
              <label for="fullName">H·ªç v√† t√™n <span class="required">*</span></label>
              <input 
                type="text" 
                id="fullName" 
                formControlName="fullName"
                [class.invalid]="isFieldInvalid('fullName')"
                placeholder="Nguy·ªÖn VƒÉn A">
              <span class="error-message" *ngIf="isFieldInvalid('fullName')">
                {{ getFieldError('fullName') }}
              </span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email"
                  [class.invalid]="isFieldInvalid('email')"
                  placeholder="email@example.com">
                <span class="error-message" *ngIf="isFieldInvalid('email')">
                  {{ getFieldError('email') }}
                </span>
              </div>

              <div class="form-group">
                <label for="phoneNumber">S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span></label>
                <input 
                  type="tel" 
                  id="phoneNumber" 
                  formControlName="phoneNumber"
                  [class.invalid]="isFieldInvalid('phoneNumber')"
                  placeholder="0901234567">
                <span class="error-message" *ngIf="isFieldInvalid('phoneNumber')">
                  {{ getFieldError('phoneNumber') }}
                </span>
              </div>
            </div>
          </div>

          <!-- Shipping Address -->
          <div class="form-section">
            <h2>ƒê·ªãa ch·ªâ giao h√†ng</h2>
            
            <div class="form-group">
              <label for="address">ƒê·ªãa ch·ªâ <span class="required">*</span></label>
              <input 
                type="text" 
                id="address" 
                formControlName="address"
                [class.invalid]="isFieldInvalid('address')"
                placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng">
              <span class="error-message" *ngIf="isFieldInvalid('address')">
                {{ getFieldError('address') }}
              </span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">T·ªânh/Th√†nh ph·ªë <span class="required">*</span></label>
                <select 
                  id="city" 
                  formControlName="city"
                  [class.invalid]="isFieldInvalid('city')">
                  <option value="">Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>
                  <option value="H·ªì Ch√≠ Minh">TP. H·ªì Ch√≠ Minh</option>
                  <option value="H√† N·ªôi">H√† N·ªôi</option>
                  <option value="ƒê√† N·∫µng">ƒê√† N·∫µng</option>
                  <option value="C·∫ßn Th∆°">C·∫ßn Th∆°</option>
                  <option value="Kh√°c">Kh√°c</option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('city')">
                  {{ getFieldError('city') }}
                </span>
              </div>

              <div class="form-group">
                <label for="district">Qu·∫≠n/Huy·ªán <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="district" 
                  formControlName="district"
                  [class.invalid]="isFieldInvalid('district')"
                  placeholder="Qu·∫≠n/Huy·ªán">
                <span class="error-message" *ngIf="isFieldInvalid('district')">
                  {{ getFieldError('district') }}
                </span>
              </div>
            </div>

            <div class="form-group">
              <label for="ward">Ph∆∞·ªùng/X√£ <span class="required">*</span></label>
              <input 
                type="text" 
                id="ward" 
                formControlName="ward"
                [class.invalid]="isFieldInvalid('ward')"
                placeholder="Ph∆∞·ªùng/X√£">
              <span class="error-message" *ngIf="isFieldInvalid('ward')">
                {{ getFieldError('ward') }}
              </span>
            </div>
          </div>

          <!-- Payment Method -->
          <div class="form-section">
            <h2>Ph∆∞∆°ng th·ª©c thanh to√°n</h2>
            
            <div class="payment-methods">
              <label 
                *ngFor="let method of paymentMethods" 
                class="payment-option"
                [class.selected]="checkoutForm.get('paymentMethod')?.value === method.value">
                <input 
                  type="radio" 
                  formControlName="paymentMethod" 
                  [value]="method.value">
                <span class="payment-icon">{{ method.icon }}</span>
                <span class="payment-label">{{ method.label }}</span>
                <span class="checkmark">‚úì</span>
              </label>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-section">
            <h2>Ghi ch√∫ ƒë∆°n h√†ng (T√πy ch·ªçn)</h2>
            <div class="form-group">
              <textarea 
                id="notes" 
                formControlName="notes"
                rows="4"
                placeholder="Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng, v√≠ d·ª•: th·ªùi gian hay ch·ªâ d·∫´n ƒë·ªãa ƒëi·ªÉm giao h√†ng chi ti·∫øt h∆°n."></textarea>
            </div>
          </div>
        </form>
      </div>

      <!-- Right Column - Order Summary -->
      <div class="order-summary-sticky">
        <div class="order-summary">
          <h2>ƒê∆°n h√†ng c·ªßa b·∫°n</h2>

          <!-- Order Items -->
          <div class="order-items">
            <div *ngFor="let item of cartItems" class="order-item">
              <div class="item-image">
                <img [src]="item.product.imageUrl || 'https://via.placeholder.com/80'" 
                     [alt]="item.product.productName">
                <span class="item-quantity">{{ item.quantity }}</span>
              </div>
              <div class="item-info">
                <p class="item-name">{{ item.product.productName }}</p>
                <p class="item-price">{{ formatPrice(calculateItemTotal(item)) }}</p>
              </div>
            </div>
          </div>

          <!-- Order Summary Details -->
          <div class="summary-details">
            <div class="summary-row">
              <span>T·∫°m t√≠nh ({{ getTotalItems() }} s·∫£n ph·∫©m)</span>
              <span>{{ formatPrice(getSubtotal()) }}</span>
            </div>

            <div class="summary-row" *ngIf="getDiscount() > 0">
              <span>Gi·∫£m gi√°</span>
              <span class="discount">-{{ formatPrice(getDiscount()) }}</span>
            </div>

            <div class="summary-row">
              <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
              <span [class.free]="getShippingFee() === 0">
                {{ getShippingFee() === 0 ? 'Mi·ªÖn ph√≠' : formatPrice(getShippingFee()) }}
              </span>
            </div>

            <div class="summary-divider"></div>

            <div class="summary-row total">
              <span>T·ªïng c·ªông</span>
              <span class="total-amount">{{ formatPrice(getTotal()) }}</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <button 
            type="button"
            class="btn btn-primary btn-order" 
            (click)="submitOrder()"
            [disabled]="isProcessing || checkoutForm.invalid">
            <span *ngIf="!isProcessing">ƒê·∫∑t h√†ng</span>
            <span *ngIf="isProcessing">
              <span class="spinner"></span> ƒêang x·ª≠ l√Ω...
            </span>
          </button>

          <button 
            type="button"
            class="btn btn-secondary" 
            (click)="goToCart()"
            [disabled]="isProcessing">
            ‚Üê Quay l·∫°i gi·ªè h√†ng
          </button>

          <!-- Security Badge -->
          <div class="security-badge">
            <span class="icon">üîí</span>
            <span>Thanh to√°n an to√†n & b·∫£o m·∫≠t</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>