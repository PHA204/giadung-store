    <div class="products-container">
      <!-- ‚úÖ LOADING OVERLAY -->
      <div *ngIf="loading" class="loading-overlay">
        <div class="spinner-large"></div>
        <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
      </div>

      <div class="products-layout" [class.loading-blur]="loading">
        <!-- Sidebar Filters -->
        <aside class="filters-sidebar">
          <div class="filter-section">
            <h3>T√¨m ki·∫øm</h3>
            <div class="search-box">
              <input 
                type="text" 
                [(ngModel)]="searchKeyword" 
                (ngModelChange)="onSearchChange($event)"
                (keyup.enter)="searchProducts()"
                placeholder="T√¨m s·∫£n ph·∫©m..."
                [disabled]="loading">
              <button class="btn-search" (click)="searchProducts()" [disabled]="loading">
                üîç
              </button>
            </div>
            <small *ngIf="isSearching" class="search-status">‚è≥ ƒêang t√¨m ki·∫øm...</small>
          </div>

          <div class="filter-section">
            <h3>Danh m·ª•c</h3>
            <div class="filter-options">
              <label class="filter-option">
                <input 
                  type="radio" 
                  name="category" 
                  [value]="null"
                  [(ngModel)]="selectedCategory"
                  (change)="applyFilters()"
                  [disabled]="loading">
                <span>T·∫•t c·∫£</span>
              </label>
              <label class="filter-option" *ngFor="let category of categories; trackBy: trackByCategory">
                <input 
                  type="radio" 
                  name="category" 
                  [value]="category.categoryId"
                  [(ngModel)]="selectedCategory"
                  (change)="applyFilters()"
                  [disabled]="loading">
                <span>{{ category.categoryName }}</span>
              </label>
            </div>
          </div>

          <div class="filter-section">
            <h3>Kho·∫£ng gi√°</h3>
            <div class="price-range">
              <input 
                type="number" 
                [(ngModel)]="minPrice" 
                placeholder="T·ª´"
                (change)="applyFilters()"
                [disabled]="loading">
              <span>-</span>
              <input 
                type="number" 
                [(ngModel)]="maxPrice" 
                placeholder="ƒê·∫øn"
                (change)="applyFilters()"
                [disabled]="loading">
            </div>
          </div>

          <div class="filter-section">
            <h3>S·∫Øp x·∫øp</h3>
            <select [(ngModel)]="sortOption" (change)="applySorting()" class="sort-select" [disabled]="loading">
              <option value="createdAt-desc">M·ªõi nh·∫•t</option>
              <option value="createdAt-asc">C≈© nh·∫•t</option>
              <option value="price-asc">Gi√° tƒÉng d·∫ßn</option>
              <option value="price-desc">Gi√° gi·∫£m d·∫ßn</option>
              <option value="productName-asc">T√™n A-Z</option>
              <option value="productName-desc">T√™n Z-A</option>
            </select>
          </div>

          <button class="btn-reset" (click)="resetFilters()" [disabled]="loading">
            X√≥a b·ªô l·ªçc
          </button>
        </aside>

        <!-- Products Grid -->
        <main class="products-main">
          <!-- Header -->
          <div class="products-header">
            <h2>
              {{ searchKeyword ? 'K·∫øt qu·∫£ t√¨m ki·∫øm: ' + searchKeyword : 'T·∫•t c·∫£ s·∫£n ph·∫©m' }}
            </h2>
            <div class="products-count">
              Hi·ªÉn th·ªã {{ products.length }} / {{ totalItems }} s·∫£n ph·∫©m
            </div>
          </div>

          <!-- ‚úÖ ERROR STATE -->
          <div *ngIf="error && !loading" class="error-message">
            <p>‚ùå {{ error }}</p>
            <button class="btn btn-primary" (click)="loadProducts()">Th·ª≠ l·∫°i</button>
          </div>

          <!-- ‚úÖ EMPTY STATE -->
          <div *ngIf="!loading && !error && products.length === 0" class="empty-state">
            <div class="empty-icon">üì¶</div>
            <h3>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3>
            <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm</p>
            <button class="btn btn-primary" (click)="resetFilters()">
              X√≥a b·ªô l·ªçc
            </button>
          </div>

          <!-- ‚úÖ PRODUCTS GRID -->
          <div class="products-grid" *ngIf="!loading && !error && products.length > 0">
            <div *ngFor="let product of products; trackBy: trackByProduct" class="product-card">
              <a [routerLink]="['/products', product.productId]" class="product-link">
                <div class="product-image">
                  <img 
                    [src]="product.imageUrl || 'https://via.placeholder.com/300'" 
                    [alt]="product.productName"
                    loading="lazy">
                  <div class="product-badges">
                    <span class="badge badge-discount" *ngIf="product.discount && product.discount > 0">
                      -{{ product.discount }}%
                    </span>
                    <span class="badge badge-new" *ngIf="isNewProduct(product)">
                      M·ªõi
                    </span>
                    <span class="badge badge-out" *ngIf="product.stockQuantity === 0">
                      H·∫øt h√†ng
                    </span>
                  </div>
                </div>

                <div class="product-info">
                  <div class="product-category">
                    {{ product.category?.categoryName }}
                  </div>
                  <h3 class="product-name">{{ product.productName }}</h3>
                  <div class="product-brand">
                    {{ product.brand?.brandName }}
                  </div>

                  <div class="product-rating" *ngIf="product.ratingAvg">
                    <span class="stars">
                      {{ getStarDisplay(product.ratingAvg) }}
                    </span>
                    <span class="rating-value">{{ product.ratingAvg }}</span>
                  </div>

                  <div class="product-price">
                    <div class="price-wrapper">
                      <span class="current-price">
                        {{ formatPrice(calculateDiscountedPrice(product)) }}
                      </span>
                    </div>
                    <div class="original-price-wrapper" *ngIf="product.discount && product.discount > 0">
                      <span class="original-price">
                        {{ formatPrice(product.price) }}
                      </span>
                    </div>
                  </div>

                  <div class="product-stock">
                    <span [class.in-stock]="product.stockQuantity > 0" 
                          [class.out-stock]="product.stockQuantity === 0">
                      {{ product.stockQuantity > 0 ? 'C√≤n ' + product.stockQuantity + ' s·∫£n ph·∫©m' : 'H·∫øt h√†ng' }}
                    </span>
                  </div>
                </div>
              </a>

              <div class="product-actions">
                <button 
                  class="btn-add-cart" 
                  (click)="addToCart($event, product)"
                  [disabled]="product.stockQuantity === 0 || loading">
                  <span *ngIf="product.stockQuantity > 0">üõí Th√™m v√†o gi·ªè</span>
                  <span *ngIf="product.stockQuantity === 0">H·∫øt h√†ng</span>
                </button>
              </div>
            </div>
          </div>

          <!-- ‚úÖ PAGINATION -->
          <div class="pagination" *ngIf="!loading && totalPages > 1">
            <button 
              class="btn-page" 
              (click)="goToPage(currentPage - 1)"
              [disabled]="currentPage === 0 || loading">
              ‚Üê Tr∆∞·ªõc
            </button>

            <div class="page-numbers">
              <button 
                *ngFor="let page of getPageNumbers()" 
                class="btn-page-number"
                [class.active]="page === currentPage"
                (click)="goToPage(page)"
                [disabled]="loading">
                {{ page + 1 }}
              </button>
            </div>

            <button 
              class="btn-page" 
              (click)="goToPage(currentPage + 1)"
              [disabled]="currentPage === totalPages - 1 || loading">
              Sau ‚Üí
            </button>
          </div>

          <!-- Page Size Selector -->
          <div class="page-size-selector" *ngIf="!loading && products.length > 0">
            <label>Hi·ªÉn th·ªã:</label>
            <select [(ngModel)]="pageSize" (change)="changePageSize()" [disabled]="loading">
              <option [value]="12">12 s·∫£n ph·∫©m</option>
              <option [value]="24">24 s·∫£n ph·∫©m</option>
              <option [value]="48">48 s·∫£n ph·∫©m</option>
            </select>
          </div>
        </main>
      </div>
    </div>
  