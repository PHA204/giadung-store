<div class="orders-container">
  <!-- Header -->
  <div class="orders-header">
    <h1>üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</h1>
    <p class="subtitle">Qu·∫£n l√Ω v√† theo d√µi ƒë∆°n h√†ng c·ªßa b·∫°n</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i ƒë∆°n h√†ng...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>C√≥ l·ªói x·∫£y ra</h3>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadOrders()">Th·ª≠ l·∫°i</button>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && !error" class="orders-content">
    <!-- Filters -->
    <div class="filters-section">
      <div class="status-filters">
        <button 
          *ngFor="let status of statusOptions" 
          class="status-filter-btn"
          [class.active]="selectedStatus === status.value"
          (click)="selectedStatus = status.value; onStatusChange()">
          <span class="status-icon">{{ status.icon }}</span>
          <span class="status-label">{{ status.label }}</span>
          <span class="status-count" *ngIf="status.value === 'ALL'">
            ({{ orders.length }})
          </span>
        </button>
      </div>

      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchKeyword"
          (ngModelChange)="onSearchChange()"
          placeholder="T√¨m theo m√£ ƒë∆°n h√†ng ho·∫∑c ƒë·ªãa ch·ªâ..."
          class="search-input">
        <button class="search-btn">üîç</button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredOrders.length === 0" class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
      <p *ngIf="selectedStatus !== 'ALL'">
        Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o ·ªü tr·∫°ng th√°i n√†y
      </p>
      <p *ngIf="selectedStatus === 'ALL'">
        H√£y kh√°m ph√° v√† ƒë·∫∑t h√†ng ngay!
      </p>
      <a routerLink="/products" class="btn btn-primary">
        Kh√°m ph√° s·∫£n ph·∫©m
      </a>
    </div>

    <!-- Orders List -->
    <div *ngIf="filteredOrders.length > 0" class="orders-list">
      <div *ngFor="let order of filteredOrders; trackBy: trackByOrderId" class="order-card">
        <!-- Order Header -->
        <div class="order-header">
          <div class="order-info">
            <h3 class="order-id">ƒê∆°n h√†ng #{{ order.orderId }}</h3>
            <span class="order-date">{{ formatDate(order.createdAt) }}</span>
          </div>
          <div class="order-status" [style.background-color]="getStatusInfo(order.currentStatus).color + '20'"
                                     [style.color]="getStatusInfo(order.currentStatus).color">
            <span class="status-icon">{{ getStatusInfo(order.currentStatus).icon }}</span>
            <span class="status-text">{{ getStatusInfo(order.currentStatus).label }}</span>
          </div>
        </div>

        <!-- Order Items Preview -->
        <div class="order-items">
          <div *ngFor="let item of order.orderDetails?.slice(0, 3); let i = index" class="order-item-preview">
           <img [src]="item.product.imageUrl || 'https://via.placeholder.com/60'" 
                [alt]="item.product.productName"
                class="item-image">
             <div class="item-info">
            <p class="item-name">{{ item.product.productName }}</p>
            <div class="item-info">
              <p class="item-name">{{ item.product.productName }}</p>
              <p class="item-quantity">x{{ item.quantity }}</p>
            </div>
            <p class="item-price">{{ formatPrice(item.unitPrice * item.quantity) }}</p>
          </div>
          <div *ngIf="(order.orderDetails?.length || 0) > 3" class="more-items">
            +{{ (order.orderDetails?.length || 0) - 3 }} s·∫£n ph·∫©m kh√°c
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <div class="summary-row">
            <span class="summary-label">S·ªë l∆∞·ª£ng:</span>
            <span class="summary-value">{{ getOrderItemCount(order) }} s·∫£n ph·∫©m</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Ph∆∞∆°ng th·ª©c thanh to√°n:</span>
            <span class="summary-value payment-method">
              {{ order.paymentMethod === 'COD' ? 'üíµ Thanh to√°n khi nh·∫≠n h√†ng' : 'üí≥ ' + order.paymentMethod }}
            </span>
          </div>
          <div class="summary-row total">
            <span class="summary-label">T·ªïng ti·ªÅn:</span>
            <span class="summary-value total-amount">{{ formatPrice(order.totalAmount) }}</span>
          </div>
        </div>

        <!-- Order Actions -->
        <div class="order-actions">
          <a [routerLink]="['/orders', order.orderId]" class="btn btn-secondary">
            Chi ti·∫øt
          </a>
          <button 
            *ngIf="canCancelOrder(order)"
            class="btn btn-danger"
            (click)="cancelOrder(order)">
            H·ªßy ƒë∆°n
          </button>
          <a 
            *ngIf="order.currentStatus?.toUpperCase() === 'DELIVERED'"
            routerLink="/products" 
            class="btn btn-primary">
            Mua l·∫°i
          </a>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        class="btn-page" 
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 0 || loading">
        ‚Üê Tr∆∞·ªõc
      </button>

      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="btn-page-number"
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
          [disabled]="loading">
          {{ page + 1 }}
        </button>
      </div>

      <button 
        class="btn-page" 
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages - 1 || loading">
        Sau ‚Üí
      </button>
    </div>
  </div>
</div>

