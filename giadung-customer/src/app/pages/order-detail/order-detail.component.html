<div class="order-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i th√¥ng tin ƒë∆°n h√†ng...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>C√≥ l·ªói x·∫£y ra</h3>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="goBack()">Quay l·∫°i danh s√°ch</button>
  </div>

  <!-- Order Detail Content -->
  <div *ngIf="order && !loading && !error" class="order-detail-content">
    <!-- Header -->
    <div class="detail-header">
      <button class="btn-back" (click)="goBack()">
        ‚Üê Quay l·∫°i
      </button>
      <div class="header-info">
        <h1>Chi ti·∫øt ƒë∆°n h√†ng #{{ order.orderId }}</h1>
        <p class="order-date">ƒê·∫∑t ng√†y: {{ formatDate(order.createdAt) }}</p>
      </div>
      <div class="order-status-badge" 
           [style.background-color]="getStatusInfo(order.currentStatus).color + '20'"
           [style.color]="getStatusInfo(order.currentStatus).color">
        <span class="status-icon">{{ getStatusInfo(order.currentStatus).icon }}</span>
        <span class="status-text">{{ getStatusInfo(order.currentStatus).label }}</span>
      </div>
    </div>

    <!-- Order Progress -->
    <div class="order-progress">
      <h3>Tr·∫°ng th√°i ƒë∆°n h√†ng</h3>
      <div class="progress-timeline">
        <div *ngFor="let status of statusOptions; let i = index" 
             class="progress-step"
             [class.active]="i <= getCurrentStatusIndex()"
             [class.current]="i === getCurrentStatusIndex()">
          <div class="step-icon">
            <span>{{ status.icon }}</span>
          </div>
          <div class="step-content">
            <p class="step-label">{{ status.label }}</p>
          </div>
          <div *ngIf="i < statusOptions.length - 1" class="step-connector"></div>
        </div>
      </div>
    </div>

    <div class="detail-grid">
      <!-- Left Column -->
      <div class="detail-left">
        <!-- Order Items -->
        <div class="detail-section">
          <h3>S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</h3>
          <div class="order-items-list">
            <div *ngFor="let item of order.orderDetails" class="order-item">
              <img [src]="item.product?.imageUrl || 'https://via.placeholder.com/100'" 
                   [alt]="item.product?.productName"
                   class="item-image">
              <div class="item-details">
                <h4 class="item-name">{{ item.product?.productName }}</h4>
                <p class="item-meta">
                  <span class="item-category">{{ item.product?.category?.categoryName }}</span>
                  <span class="item-brand">{{ item.product?.brand?.brandName }}</span>
                </p>
                <p class="item-price-info">
                  {{ formatPrice(item.unitPrice) }} √ó {{ item.quantity }}
                </p>
              </div>
              <div class="item-total">
                {{ formatPrice(item.unitPrice * item.quantity) }}
              </div>
            </div>
          </div>
        </div>

        <!-- Shipping Address -->
        <div class="detail-section">
          <h3>üöö ƒê·ªãa ch·ªâ giao h√†ng</h3>
          <div class="address-box">
            <p class="customer-name">{{ order.user?.fullName }}</p>
            <p class="customer-phone">{{ order.user?.phoneNumber }}</p>
            <p class="customer-address">{{ order.shippingAddress }}</p>
          </div>
        </div>
      </div>

      <!-- Right Column - Summary -->
      <div class="detail-right">
        <div class="summary-card">
          <h3>Th√¥ng tin thanh to√°n</h3>
          
          <div class="summary-section">
            <div class="summary-row">
              <span class="label">T·∫°m t√≠nh:</span>
              <span class="value">{{ formatPrice(calculateSubtotal()) }}</span>
            </div>
            <div class="summary-row">
              <span class="label">Ph√≠ v·∫≠n chuy·ªÉn:</span>
              <span class="value free">Mi·ªÖn ph√≠</span>
            </div>
            <div class="summary-divider"></div>
            <div class="summary-row total">
              <span class="label">T·ªïng c·ªông:</span>
              <span class="value">{{ formatPrice(order.totalAmount) }}</span>
            </div>
          </div>

          <div class="payment-info">
            <h4>Ph∆∞∆°ng th·ª©c thanh to√°n</h4>
            <p class="payment-method">
              {{ order.paymentMethod === 'COD' ? 'üíµ Thanh to√°n khi nh·∫≠n h√†ng' : 'üí≥ ' + order.paymentMethod }}
            </p>
          </div>

          <!-- Actions -->
          <div class="order-actions">
            <button 
              *ngIf="canCancelOrder()"
              class="btn btn-danger btn-block"
              (click)="cancelOrder()">
              ‚ùå H·ªßy ƒë∆°n h√†ng
            </button>
            <a 
              *ngIf="order.currentStatus?.toUpperCase() === 'DELIVERED'"
              routerLink="/products" 
              class="btn btn-primary btn-block">
              üõí Mua l·∫°i
            </a>
            <button class="btn btn-secondary btn-block" (click)="goBack()">
              üìã Xem ƒë∆°n h√†ng kh√°c
            </button>
          </div>

          <!-- Customer Support -->
          <div class="support-box">
            <p class="support-title">C·∫ßn h·ªó tr·ª£?</p>
            <p class="support-text">Li√™n h·ªá: <strong>1900-xxxx</strong></p>
            <p class="support-text">Email: <strong>support&#64;giadung.vn</strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>